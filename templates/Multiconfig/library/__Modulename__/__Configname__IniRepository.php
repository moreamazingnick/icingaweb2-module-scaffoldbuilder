<?php

/* Originally from Icinga Web 2 Elasticsearch Module (c) 2017 Icinga Development Team | GPLv2+ */
/* generated by icingaweb2-module-scaffoldbuilder | GPLv2+ */

namespace Icinga\Module\__Modulename__;

use Icinga\Data\ConfigObject;
use Icinga\Repository\IniRepository;

class __Configname__IniRepository extends IniRepository
{
    protected $configs = [
        '__configname__' => [
            'name'      => '__configname__',
            'keyColumn' => 'name',
            'module'    => '__modulename__'
        ]
    ];

    protected $queryColumns = [
        '__configname__' => [
            'name',
            'password',
            'nameofcheckbox',
        ]
    ];
    protected $triggers = array('__configname__');
    /**
     * Reset every protected field to its old value if updated to ""
     * Nessesary for password leakage prevention
     * @param   ConfigObject    $old
     * @param   ConfigObject    $new
     *
     * @return  ConfigObject
     */
    protected function onUpdate__Configname__(ConfigObject $old, ConfigObject$new)
    {
        foreach($this->protectedFields as $field){

            if( in_array($field, $new->keys()) && in_array($field, $old->keys()) && $new->get($field) ==""){
                $new->{$field} =  $old->get($field);
            }
        }
        return $new;
    }
    public function setProtectedFields($array){
        $this->protectedFields=$array;

    }

    public function getIdentifierName(){
        return $this->configs['__configname__']['keyColumn'];
    }
}
